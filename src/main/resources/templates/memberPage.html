<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="/css/memberPage.css" />
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <title>memberPage</title>
  </head>
  <body>
    <div th:replace="~{layouts/header :: header}"></div>

    <div class="my-page">
      <div class="title">My Page</div>
      <!-- <form> -->
      <div class="my-page-item">
        <div class="item-box">
          <div class="item-1">
            <label class="item-2" for="id">ID :</label>
            <input class="item-3-1" type="text" id="id" th:value="${member.loginId}" disabled />
          </div>
        </div>
        <div class="item-box">
          <div class="item-1">
            <label class="item-2" for="name">Name :</label>
            <input class="item-3-3" type="text" id="name" th:value="${member.name}" />
            <div class="item-4-3"></div>
          </div>
        </div>
        <div class="item-box">
          <div class="item-1">
            <label class="item-2" for="nickname">Nickname :</label>
            <input
              class="item-3-4"
              type="text"
              id="nickname"
              th:value="${member.nickname}"
              disabled
            />
          </div>
        </div>
        <div class="item-box">
          <div class="item-1">
            <label class="item-2" for="phone">Phone :</label>
            <input class="item-3-5" type="text" id="phone" th:value="${member.phoneNumber}" />
            <div class="item-4-5"></div>
          </div>
        </div>
        <div class="item-box">
          <div class="item-1">
            <label class="item-2" for="department">Department :</label>
            <input class="item-3-6" type="text" id="department" th:value="${member.department}" />
            <div class="item-4-6"></div>
          </div>
        </div>
        <button class="item-btn-1">Edit Profile</button>
        <button class="item-btn-2">Edit Password</button>
      </div>
      <!-- </form> -->

      <div id="modal-overlay-1"></div>
      <div id="modal-1">
        <h2>비밀번호 확인</h2>
        <form>
          <input type="password" id="current-password" placeholder="현재 비밀번호" required />
          <button class="pw-check" type="submit">확인</button>
        </form>
        <button class="item-btn-3-1">닫기</button>
      </div>

      <div id="modal-overlay-2"></div>
      <div id="modal-2">
        <h2>비밀번호 변경</h2>
        <form>
          <input type="password" id="cur-password" placeholder="현재 비밀번호" required />
          <input type="password" id="new-password" placeholder="새로운 비밀번호" required />
          <input
            type="password"
            id="confirm-password"
            placeholder="새로운 비밀번호 확인"
            required
          />
          <button class="pw-change" type="submit">변경</button>
        </form>
        <button class="item-btn-3-2">닫기</button>
      </div>

      <!-- <div class="title">My History</div>
      <div class="my-history-item">
        <div class="item-q">My Questions</div>
        <div class="item-q-1">
          <div class="item-q-2">Q1. how to learn computer security ??</div>
          <div class="item-q-2">Q2. how to learn computer security ??</div>
          <div class="item-q-2">Q3. how to learn computer security ??</div>
        </div>
        <div class="item-a">My Answers</div>
        <div class="item-a-1">
          <div class="item-a-2">A1. how to learn computer security ??</div>
          <div class="item-a-2">A2. how to learn computer security ??</div>
          <div class="item-a-2">A3. how to learn computer security ??</div>
        </div>
        <div class="item-c">My Comments</div>
        <div class="item-c-1">
          <div class="item-c-2">C1. how to learn computer security ??</div>
          <div class="item-c-2">C2. how to learn computer security ??</div>
          <div class="item-c-2">C3. how to learn computer security ??</div>
        </div>
      </div> -->
    </div>

    <div th:replace="~{layouts/footer :: footer}"></div>

    <script>
      let editProfile = document.querySelector('.item-btn-1');
      let pw_check = document.querySelector('.pw-check');
      let closeModal1 = document.querySelector('.item-btn-3-1');
      let editPassword = document.querySelector('.item-btn-2');
      let pw_change = document.querySelector('.pw-change');
      let closeModal2 = document.querySelector('.item-btn-3-2');

      editProfile.onclick = function () {
        document.getElementById('modal-overlay-1').style.display = 'block';
        document.getElementById('modal-1').style.display = 'block';
      };

      pw_check.onclick = function () {
        let pw = document.getElementById('current-password');

        $.ajax({
          type: 'POST',
          url: '/my-page/validation-password',
          headers: { 'Content-Type': 'application/json' }, // JSON 데이터로 지정
          data: JSON.stringify({ password: pw.value }), // JSON 형식으로 데이터 전송
          success: function (result) {
            alert('암호가 같습니다 !!');
            // validation(event);
          },
          error: function () {
            alert('암호가 다릅니다 ..');
          },
        });
      };

      function validation(event) {
        // 이름 : 한글로만 이루어져 있는 2글자 이상 (공백 X)
        let na_reg = /^[가-힣]{2,}$/;
        // 전화번호 : 숫자로만 이루어져 있는 11글자 (하이픈 X)
        let ph_reg = /^\d{11}$/;

        let na = document.getElementById('name');
        let ph = document.getElementById('phone');
        let de = document.getElementById('department');

        let na_result = document.querySelector('.item-4-3');
        let ph_result = document.querySelector('.item-4-5');
        let de_result = document.querySelector('.item-4-6');

        na_result.innerText = '';
        ph_result.innerText = '';
        de_result.innerText = '';

        if (na.value.trim() === '') {
          na_result.innerText = '이름을 입력해주세요.';
          na.focus();
          event.preventDefault();
          return false;
        }
        if (ph.value.trim() === '') {
          ph_result.innerText = '전화번호를 입력해주세요.';
          ph.focus();
          event.preventDefault();
          return false;
        }
        if (de.value.trim() === '') {
          de_result.innerText = '소속을 입력해주세요.';
          de.focus();
          event.preventDefault();
          return false;
        }

        if (!na_reg.test(na.value)) {
          na_result.innerText = '이름은 한글로만 이루어진 2글자 이상이어야 합니다.';
          na.value = '';
          na.focus();
          event.preventDefault();
          return false;
        }
        if (!ph_reg.test(ph.value)) {
          ph_result.innerText = '전화번호는 숫자로만 이루어진 11글자여야 합니다.';
          ph.value = '';
          ph.focus();
          event.preventDefault();
          return false;
        }
      }

      editPassword.onclick = function () {
        document.getElementById('modal-overlay-2').style.display = 'block';
        document.getElementById('modal-2').style.display = 'block';
      };

      closeModal1.onclick = function () {
        document.getElementById('modal-overlay-1').style.display = 'none';
        document.getElementById('modal-1').style.display = 'none';
      };

      closeModal2.onclick = function () {
        document.getElementById('modal-overlay-2').style.display = 'none';
        document.getElementById('modal-2').style.display = 'none';
      };
    </script>
  </body>
</html>
