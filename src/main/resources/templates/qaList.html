<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="/css/qaList.css" />
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p"
      crossorigin="anonymous"
    ></script>

    <title>qaList</title>
  </head>

  <body>
    <div th:replace="~{layouts/header :: header}"></div>

    <!-- ë°°ë„ˆ  -->
    <div id="carouselExampleIndicators" class="carousel slide" data-bs-ride="carousel">
      <div class="carousel-indicators">
        <button
          type="button"
          data-bs-target="#carouselExampleIndicators"
          data-bs-slide-to="0"
          class="active"
          aria-current="true"
          aria-label="Slide 1"
        ></button>
        <button
          type="button"
          data-bs-target="#carouselExampleIndicators"
          data-bs-slide-to="1"
          aria-label="Slide 2"
        ></button>
        <button
          type="button"
          data-bs-target="#carouselExampleIndicators"
          data-bs-slide-to="2"
          aria-label="Slide 3"
        ></button>
      </div>
      <div class="carousel-inner">
        <div class="carousel-item active">
          <div class="firstBanner_container">
            <div class="firstBanner_left">
              <button class="firstBanner_button">Notice</button>
              <h2 class="firstBanner_title">ì½œë¡œë‹ˆ ì›¹ ì‚¬ì´íŠ¸ ì˜¤í”ˆ!ğŸ‰</h2>
              <h2 class="firstBanner_sub_title">ëª¨ë¥´ëŠ”ê²Œ ìˆë‹¤ë©´ ììœ ë¡­ê²Œ ì§ˆë¬¸ì„ ë‚¨ê²¨ë³´ì„¸ìš”</h2>
            </div>
            <div class="firstBanner_right">
              <img src="https://holaworld.io/images/banner/33.png" width="250px" height="160px" />
            </div>
          </div>
        </div>
        <div class="carousel-item">
          <div class="firstBanner_container">
            <div class="firstBanner_left">
              <button class="firstBanner_button">Notice</button>
              <h2 class="firstBanner_title">9ì›”7ì¼ ì½œë¡œë‹ˆ ì¢…ê°•ì´íšŒ</h2>
              <h2 class="firstBanner_sub_title">ì¥ì†Œ: ê½ƒë‹¤ì§€ ì…ì¥ë¹„: 10000ì›</h2>
            </div>
            <div class="firstBanner_right">
              <img src="https://holaworld.io/images/banner/33.png" width="250px" height="160px" />
            </div>
          </div>
        </div>
        <div class="carousel-item">
          <div class="firstBanner_container">
            <div class="firstBanner_left">
              <button class="firstBanner_button">Notice</button>
              <h2 class="firstBanner_title">ì¡¸ì—…í•œ ì„ ë°°ì˜ ì´ì•¼ê¸°ê°€ ê¶ê¸ˆí•˜ë‹¤ë©´?</h2>
              <h2 class="firstBanner_sub_title">
                9ì›”7ì¼ ì¡¸ì—…í•˜ì‹  ë°•íƒœë¯¼ ì„ ë°°ì˜ ì—°ì•  ì´ì•¼ê¸°ê°€ ê¶ê¸ˆí•˜ë‹¤ë©´ ì•„ë˜ êµ¬ê¸€ í¼ì„ í†µí•´
                ì‹ ì²­í•´ì£¼ì„¸ìš”
              </h2>
            </div>
            <div class="firstBanner_right">
              <img src="https://holaworld.io/images/banner/33.png" width="250px" height="160px" />
            </div>
          </div>
        </div>
      </div>
    </div>
    <!-- ì§ˆë¬¸ ëª©ë¡  -->
    <div class="qa-page">
      <!-- ê²€ìƒ‰ -->
      <div class="search-container">
        <form th:action="@{/post-list/{categoryId}(categoryId=${categoryDtoList.presentCategoryId})}" method="get" autocomplete="on">
          <label for="searchType"></label>
          <select id="searchType" name="searchType" th:value="${searchType}">
            <option value="NICKNAME" th:selected="${#strings.equals(searchType, 'NICKNAME')}">
              ë‹‰ë„¤ì„ìœ¼ë¡œ ê²€ìƒ‰
            </option>
            <option value="TITLE" th:selected="${#strings.equals(searchType, 'TITLE')}">
              ì œëª©ìœ¼ë¡œ ê²€ìƒ‰
            </option>
          </select>
          <input
            type="text"
            id="searchValue"
            name="searchValue"
            placeholder="ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•˜ì„¸ìš”"
            th:value="${searchValue}"
          />
          <button class="searchBtn" type="submit">ê²€ìƒ‰</button>
        </form>
      </div>
      <!-- ë‹µë³€ ì™„ë£Œ & ì •ë ¬ & ì§ˆë¬¸ ë“±ë¡ -->
      <div class="answer-sort-enroll-container">
        <!-- ë‹µë³€ ì™„ë£Œ -->
        <div class="answer-container">
          <input type="checkbox" id="check_btn" th:checked="${answered}" />
          <label for="check_btn"><span>ë‹µë³€ ì™„ë£Œëœ ê¸€ë§Œ ë³´ê¸°</span></label>
        </div>
        <!-- ì •ë ¬ & ë“±ë¡ -->
        <div class="sort-enroll-container">
          <!-- ì •ë ¬ -->
          <div class="sort-container">
            <label for="sortSelect"></label>
            <select id="sortSelect" name="sort" th:value="${sortBy}">
              <option th:selected="${#strings.isEmpty(sortBy)}">ì •ë ¬ ê¸°ì¤€</option>
              <option
                value="createdAtDesc"
                th:selected="${#strings.equals(sortBy, 'createdAtDesc')}"
              >
                ìµœì‹ ìˆœ
              </option>
              <option value="createdAtAsc" th:selected="${#strings.equals(sortBy, 'createdAtAsc')}">
                ì˜¤ë˜ëœ ìˆœ
              </option>
              <option value="title" th:selected="${#strings.equals(sortBy, 'title')}">
                ì œëª© ìˆœ
              </option>
            </select>
          </div>
          <!-- ì§ˆë¬¸ ë“±ë¡ -->
          <button class="enroll-btn" id="postwritebtn">ì§ˆë¬¸ ë“±ë¡</button>
        </div>
      </div>
      <!-- ê³µì§€ ë° ì¹´ë“œ -->
      <div class="card-container">
        <!-- ê³µì§€ -->
        <div
          th:each="postDto : ${postDtoListNotice}"
          class="card-item notice"
          th:onclick="'redirectToNotice(' + ${postDto.postId} + ')'"
        >
          <div class="card-info">
            <div class="card-header">
              <div class="card-state-notice">
                <div>ê³µì§€ì‚¬í•­</div>
              </div>
              <div class="card-title" th:text="${postDto.title}"></div>
            </div>
            <p class="card-content" th:text="${postDto.content}"></p>
            <div class="card-footer">
              <p class="card-author-date">
                <span th:text="${postDto.createdBy}"></span>
                <span>|</span>
                <span th:text="${postDto.enrollTime}"></span>
              </p>
              <p class="card-view-answer">
                <i class="fa-regular fa-eye"></i>
                <span th:text="${postDto.viewCount}"></span>
              </p>
            </div>
          </div>
        </div>
        <!-- ì¹´ë“œ -->
        <div
          th:each="postDto : ${postDtoList}"
          class="card-item"
          th:onclick="'redirectToPost(' + ${postDto.postId} + ')'"
        >
          <div class="card-info">
            <div class="card-header">
              <div class="card-state-yes" th:if="${postDto.answered}">
                <div>ë‹µë³€ ì™„ë£Œ</div>
              </div>
              <div class="card-state-no" th:unless="${postDto.answered}">
                <div>ë‹µë³€ ëŒ€ê¸°</div>
              </div>
              <div class="card-title" th:text="${postDto.title}"></div>
            </div>
            <p class="card-content" th:text="${postDto.content}"></p>
            <div class="card-footer">
              <p class="card-author-date">
                <span th:text="${postDto.createdBy}"></span>
                <span>|</span>
                <span th:text="${postDto.enrollTime}"></span>
              </p>
              <p class="card-view-answer">
                <i class="fa-regular fa-eye"></i>
                <span th:text="${postDto.viewCount}"></span>
                <i class="fa-regular fa-comment"></i>
                <span th:text="${postDto.answerCount}"></span>
              </p>
            </div>
          </div>
        </div>
      </div>

      <input type="hidden" id="categoryId" th:value="${categoryDtoList.presentCategoryId}">

      <!-- í˜ì´ì§€ë„¤ì´ì…˜ -->
      <div class="pagination-container">
        <ul
                class="pagination"
                th:with="start=${(pageNum/maxPage)*maxPage + 1},
          end=(${(totalPages == 0) ? 1 : (start + (maxPage - 1) < totalPages ? start + (maxPage - 1) : totalPages)}),
          prev=${start - maxPage - 1},
          next=${start + maxPage - 1},
          maxPage=${5},
          currentCategoryId=${categoryDtoList.presentCategoryId}"
        >
          <!-- ì´ì „ í˜ì´ì§€ë¡œ ì´ë™ -->
          <li th:if="${start > 1}">
            <a
                    th:if="${currentCategoryId}"
                    th:href="@{/post-list/{id}(page=${prev}, searchType=${searchType}, searchValue=${searchValue}, sortBy=${sortBy}, answered=${answered}, id=${categoryDtoList.presentCategoryId})}"
                    th:text="'<<'"
            ></a>
            <a
                    th:unless="${currentCategoryId}"
                    th:href="@{/post-list(page=${prev}, searchType=${searchType}, searchValue=${searchValue}, sortBy=${sortBy}, answered=${answered})}"
                    th:text="'<<'"
            ></a>
          </li>

          <!-- í˜ì´ì§€ ë²ˆí˜¸ ì¶œë ¥ -->
          <li
                  th:each="page: ${#numbers.sequence(start, end)}"
                  th:class="${page == (pageNum + 1)} ? 'active' : ''"
          >
            <a
                    th:if="${currentCategoryId}"
                    th:href="@{/post-list/{id}(page=${page - 1}, searchType=${searchType}, searchValue=${searchValue}, sortBy=${sortBy}, answered=${answered}, id=${categoryDtoList.presentCategoryId})}"
                    th:text="${page}"
            ></a>
            <a
                    th:unless="${currentCategoryId}"
                    th:href="@{/post-list(page=${page - 1}, searchType=${searchType}, searchValue=${searchValue}, sortBy=${sortBy}, answered=${answered})}"
                    th:text="${page}"
            ></a>
          </li>

          <!-- ë‹¤ìŒ í˜ì´ì§€ë¡œ ì´ë™ -->
          <li th:if="${end < totalPages}">
            <a
                    th:if="${currentCategoryId}"
                    th:href="@{/post-list/{id}(page=${next}, searchType=${searchType}, searchValue=${searchValue}, sortBy=${sortBy}, answered=${answered}, id=${categoryDtoList.presentCategoryId})}"
                    th:text="'>'"
            ></a>
            <a
                    th:unless="${currentCategoryId}"
                    th:href="@{/post-list(page=${next}, searchType=${searchType}, searchValue=${searchValue}, sortBy=${sortBy}, answered=${answered})}"
                    th:text="'>'"
            ></a>
          </li>

          <li th:if="${end < totalPages}">
            <a
                    th:if="${currentCategoryId}"
                    th:href="@{/post-list/{id}(page=${totalPages - 1}, searchType=${searchType}, searchValue=${searchValue}, sortBy=${sortBy}, answered=${answered}, id=${categoryDtoList.presentCategoryId})}"
                    th:text="'>>'"
            ></a>
            <a
                    th:unless="${currentCategoryId}"
                    th:href="@{/post-list(page=${totalPages - 1}, searchType=${searchType}, searchValue=${searchValue}, sortBy=${sortBy}, answered=${answered})}"
                    th:text="'>>'"
            ></a>
          </li>
        </ul>
      </div>
    </div>

    <div th:replace="~{layouts/footer :: footer}"></div>

    <script>
      function redirectToPost(postId) {
        window.location.href = '/post/' + postId + '?postType=p';
      }

      function redirectToNotice(postId) {
        window.location.href = '/post/' + postId + '?postType=n';
      }

      var postwritebtn = document.getElementById('postwritebtn');
      postwritebtn.addEventListener('click', function () {
        location.href = '/post-form';
        console.log('postê¸€ì“°ê¸° btn');
      });

      document.getElementById('sortSelect').addEventListener('change', function (event) {
        if (event.target.value === 'ì •ë ¬ ê¸°ì¤€') return;
        var selectedValue = this.value;
        var searchValue = document.getElementById('searchValue').value;
        var searchType = document.getElementById('searchType').value;
        var categoryId = document.getElementById('categoryId').value;
        console.log(categoryId);
        window.location.href =
          '/post-list/'+ categoryId + '?sortBy=' +
          selectedValue +
          '&searchType=' +
          searchType +
          '&searchValue=' +
          searchValue;
      });

      const checkbox = document.getElementById('check_btn');
      // ì²´í¬ ë°•ìŠ¤ ìƒíƒœ ë³€ê²½ ì‹œ ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ ë“±ë¡
      checkbox.addEventListener('change', function () {
        const urlParams = new URLSearchParams(window.location.search);

        if (this.checked) {
          urlParams.set('answered', 'true');
        } else {
          urlParams.delete('answered');
        }

        // ë³€ê²½ëœ íŒŒë¼ë¯¸í„°ë¡œ ìƒˆë¡œìš´ URL ìƒì„±
        const newUrl = `${window.location.pathname}?${urlParams.toString()}`;

        // ìƒˆë¡œìš´ URLë¡œ í˜ì´ì§€ ì´ë™
        window.location.href = newUrl;
      });
    </script>
  </body>
</html>
