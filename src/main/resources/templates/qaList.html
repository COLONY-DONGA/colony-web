<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="/css/qaList.css" />
    <title>qaList</title>
    <style>
      * {
        box-sizing: border-box;
      }

      body {
        font-family: 'Roboto', Arial, sans-serif;
        background-color: #f9f9f9;
        margin: 5%;
        padding: 0;
        color: #4d4d4d;
        line-height: 1.6;
      }

      h1 {
        text-align: center;
        padding: 20px 0;
        font-size: 28px;
        font-weight: 500;
        color: #3a3a3a;
        border-bottom: 1px solid rgba(58, 58, 58, 0.1);
      }


      form > div {
        display: flex;
        align-items: center;
        gap: 10px;
      }

      label {
        font-size: 16px;
        font-weight: 500;
      }

      select, input, button {
        font-size: 16px;
        padding: 8px 12px;
        border: none;
        background-color: #e9e9e9;
        border-radius: 12px;
        transition: all 0.3s;
        outline: none;
      }

      select:hover, input:hover, button:hover {
        background-color: #d1d1d1;
      }

      button {
        cursor: pointer;
        color: #fff;
        background-color: #007bff;
      }

      button:hover {
        background-color: #0056b3;
      }

      .card-container {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
        gap: 20px;
        width: 100%;
      }

      .card {
        position: relative;
        overflow: hidden;
        background-color: #fff;
        border-radius: 15px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        padding: 20px;
        cursor: pointer;
        transition: transform 0.3s;
      }

      .card:hover {
        transform: translateY(-5px);
        box-shadow: 0 5px 20px rgba(0, 0, 0, 0.3);
      }

      .card-title {
        font-size: 22px;
        font-weight: 500;
        color: #3a3a3a;
        margin-bottom: 10px;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
      }

      .card-content {
        font-size: 16px;
        margin-bottom: 10px;
        height: 60px;
        overflow: hidden;
        display: -webkit-box;
        -webkit-line-clamp: 3;
        -webkit-box-orient: vertical;
        text-overflow: ellipsis;
      }

      .card-info span {
        font-weight: bold;
      }

      .search-sort-container {
          display: flex;
          justify-content: space-between;
          align-items: center;
          width: 100%;
          padding: 20px 0;
      }

      /* Responsive styles */
      @media (max-width: 768px) {
          form {
              flex-direction: column;
              gap: 10px;
          }

          select, input {
              width: 100%;
          }
      }
    </style>
  </head>
  <body>
    <div th:replace="~{layouts/header :: header}"></div>

    <h1>질문 리스트</h1>
    <div class="search-sort-container fade-in">
      <form th:action="@{/post-list}" method="get" autocomplete="on">
        <label for="searchType">검색 종류:</label>
        <select id="searchType" name="searchType" th:value="${searchType}">
          <option value="NICKNAME" th:selected="${#strings.equals(searchType, 'NICKNAME')}">
            이름
          </option>
          <option value="TITLE" th:selected="${#strings.equals(searchType, 'TITLE')}">
            제목
          </option>
        </select>
        <input
          type="text"
          id="searchValue"
          name="searchValue"
          placeholder="검색어를 입력하세요"
          th:value="${searchValue}"
        />
        <button type="submit">검색</button>
      </form>
    </div>

    <div class="sort-container fade-in">
      <label for="sortSelect">정렬 기준:</label>
      <select id="sortSelect" name="sort" th:value="${sortBy}">
        <option value="createdAt" th:selected="${#strings.equals(sortBy, 'createdAt')}">
          최신순
        </option>
        <option value="title" th:selected="${#strings.equals(sortBy, 'title')}">제목</option>
      </select>
    </div>

    <!-- 카드 형식으로 변경된 내용 -->
    <div class="card-container fade-in">
      <!-- PostDtoList를 반복하여 각각의 PostDto를 카드 형식으로 출력합니다. -->
      <div
        th:each="postDto : ${postDtoList}"
        class="card"
        th:onclick="'redirectToPost(' + ${postDto.postId} + ')'"
      >
        <h2 class="card-title" th:text="${postDto.title}"></h2>
        <p class="card-content" th:text="${postDto.content}"></p>
        <p class="card-author">작성자: <span th:text="${postDto.createdBy}"></span></p>
        <p class="card-date">
          Created At: <span th:text="${#temporals.format(postDto.createdAt, 'yyyy-MM-dd')}"></span>
        </p>

        <div th:if="${postDto.answered}">
          <span>답변 완료</span>
        </div>
        <div th:unless="${postDto.answered}">
          <span>답변 대기 중</span>
        </div>
      </div>
    </div>

    <div th:replace="~{layouts/footer :: footer}"></div>
  </body>

  <!-- 자바스크립트 코드 추가 -->
  <script>
    function redirectToPost(postId) {
      window.location.href = '/post/' + postId;
    }

    // 정렬 기준 선택 시 서버로 요청 보내기
    document.getElementById('sortSelect').addEventListener('change', function () {
      var selectedValue = this.value;
      var searchValue = document.getElementById('searchValue').value; // 검색어 입력 값을 가져옴
      var searchType = document.getElementById('searchType').value; // 검색어 입력 값을 가져옴
      window.location.href =
        '/post-list?sortBy=' +
        selectedValue +
        '&searchType=' +
        searchType +
        '&searchValue=' +
        searchValue;
    });
  </script>
</html>
