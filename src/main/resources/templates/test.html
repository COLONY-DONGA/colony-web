<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <link rel="stylesheet" href="../static/css/qaDetail.css" />
    <link rel="stylesheet" href="../static/css/headerfooter.css" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"
    />
    <title>질문 세부 페이지</title>
  </head>

  <body>
    <!--  로그인 유저 닉네임-->
    <div sec:authorize="isAuthenticated()">
      <span
        class="member-nickname"
        sec:authentication="principal.nickname"
        style="display: none"
      ></span>
    </div>
    <div sec:authorize="isAnonymous()">
      <span class="member-nickname" value="" style="display: none"></span>
    </div>

    <div th:replace="~{layouts/header :: header}"></div>
    <br />

    <div class="qadetail-frame">
      <section class="article-detail table-common con row">
        <table class="cell" border="1">
          <colgroup>
            <col width="100px" />
          </colgroup>
          <tbody>
            <tr class="article-title">
              <th>제목</th>
              <td class="question-title" th:text="${postDto.title}">title</td>
              <th>작성자</th>
              <td id="post-writer" class="question-title" th:text="${postDto.createdBy}">name</td>
              <!--시큐리티 변수-->
            </tr>
            <!--<tr class="article-info">
              <th>날짜</th>
              <td th:text="${postDto.updatedAt}">date</td>
            </tr> -->
            <tr class="article-body">
              <!--내용칸-->
              <td colspan="4" th:text="${postDto.content}">Q. question area</td>
            </tr>
          </tbody>
        </table>
        <input id="postId" type="hidden" th:value="${postDto.postId}" />
      </section>
      ----------<!--질문 첨부파일 이미지+이미지명 출력파트-->
      <div class="file-box">
        <!-- Loop through the file list -->
        <div th:each="file : ${postDto.imageDtoList}">
          <div class="file-img">
            <img th:src="|/images/${file.storeImageName}|" alt="이미지" />
          </div>
        </div>
      </div>

      <!--버튼바들-->
      <div class="tool-box" id="answer-text-box">
        <div class="btn">
          <button class="qabtn" id="qabtn">답변하기</button>
          <!--<button class="listbtn" id="listbtn">목록</button>-->
          <button class="editbtn" id="editbtn">수정</button>
          <button class="deletebtn" id="deletebtn">삭제</button>
          <!--<a href="#" class="btn green rounded">Button</a>-->
        </div>
      </div>

      <br />
      <br />

      <br />

      <div class="answer-text-box" id="answer-text-box">
        <div
          th:each="answer : ${answerList}"
          class="answer-text"
          id="answer-text-box-[[${answer.id}]]"
        >
          <!-- 답변데이터가 타임리프로 이곳에 들어갈 예정입니다 -->
          <span th:text="${'A. : ' + answer.content}">Q.답변박스</span>
        </div>
      </div>
      <div class="answer-box"></div>
    </div>

    <!--파일-->

    <div class="tool-box" id="answer-text-box">
      <div class="btn">
        <button class="editbtn" id="editbtn123">수정</button>
        <button class="deletebtn" id="deletebtn123">삭제</button>
        <!--<a href="#" class="btn green rounded">Button</a>-->
      </div>
    </div>
    <div class="comments-container">
      <ul id="comments-list" class="comments-list"></ul>

      <!--새댓글 작성부분-->
      <div class="input-box">
        <div class="inputframe">
          <br />

          <h5>New Comment : <input type="text" class="input-text" id="newComment" /></h5>
          <button class="new-comment-btn" id="add-comment-button">작성</button>
        </div>
      </div>
    </div>

    <script>
      // 서버에서 데이터를 받아와서 댓글과 대댓글 HTML 요소를 생성하는 함수
      function createCommentElements(comments) {
        var commentsList = $('#comments-list');

        comments.forEach(function (comment) {
          var commentElement = `
      <li>
        <div class="${comment.isReply ? 'comments-list reply-list' : 'comment-main-level'}">
          <div class="comment-avatar">
            <img src="../static/img/colony.jpg" alt="" />
          </div>
          <div class="comment-box">
            <div class="comment-head">
              <h6 class="comment-name">${comment.name}</h6>
              <i class="fa fa-reply" id="replyComment"></i>
              ${comment.isReply ? '' : '<i class="fa fa-heart" id="like"></i>'}
            </div>
            <div class="comment-content">${comment.content}</div>
          </div>
        </div>
      </li>
    `;

          commentsList.append(commentElement);
        });
      }

      /*$.ajax({
        url: '서버의_데이터_요청_주소',
        type: 'GET',
        dataType: 'json',
        success: function (response) {
          // 받아온 데이터로 댓글과 대댓글 HTML 요소를 생성합니다.
          createCommentElements(response.comments);
        },
        error: function (error) {
          console.error('댓글 데이터를 불러오는데 실패했습니다:', error);
        },
      });*/

      // 테스트를 위한 더미 데이터 (서버에서 받아온 것으로 가정)
      var dummyData = {
        comments: [
          {
            name: '최유현',
            content: '댓글텍스트입니다. 첫 번째 댓글입니다.',
            isReply: false,
          },
          {
            name: '바규진',
            content: '댓글텍스트입니다. 첫 번째 댓글에 대한 첫 번째 대댓글입니다.',
            isReply: true,
          },
          {
            name: '김영웅',
            content: '댓글텍스트입니다. 두 번째 댓글입니다.',
            isReply: false,
          },
          {
            name: '박수호',
            content: '댓글텍스트입니다. 두 번째 댓글에 대한 첫 번째 대댓글입니다.',
            isReply: true,
          },
        ],
      };

      // 테스트용 더미 데이터로 댓글과 대댓글 HTML 요소를 생성합니다.
      createCommentElements(dummyData.comments);
    </script>
    <div th:replace="~{layouts/footer :: footer}"></div>
  </body>
</html>
